<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="community">



<!-- list : book 테이블 조인해서 목록 출력  -->
    <select id="list" resultType="kr.co.itwill.community.BookReadDTO">
        SELECT c_code, c_name, c_des, c_bcode, c_local, c_id, c_chat, c_banner ,c_count, c_state, c_rdate, b_name, b_bookcover
        FROM book JOIN community
        ON book.b_code = community.c_bcode
    </select>

    <select id="search" resultType="kr.co.itwill.community.BookReadDTO" parameterType="String">
        SELECT c_code, c_name, c_des, c_bcode, c_local, c_id, c_chat, c_banner ,c_count, c_state, c_rdate, b_name, b_bookcover
        FROM book JOIN community
        ON book.b_code = community.c_bcode
        WHERE c_name LIKE CONCAT('%', #{keyword}, '%') || b_name LIKE CONCAT('%', #{keyword}, '%')
    </select>


    <!-- list 최신순 정렬 -->
    <select id="newComm" resultType="kr.co.itwill.community.BookReadDTO">
        SELECT c_code, c_name, c_des, c_bcode, c_local, c_id, c_chat, c_banner ,c_count, c_state, c_rdate, b_name, b_bookcover
        FROM book JOIN community
        ON book.b_code = community.c_bcode
        ORDER BY c_rdate DESC LIMIT 3
    </select>


    <!-- read 상세보기  -->
    <select id="read" resultType="kr.co.itwill.community.BookReadDTO">
        SELECT c_code, c_name, c_des, c_bcode, c_local, c_id, c_chat, c_banner ,c_count, c_state, c_rdate, b_name, b_bookcover, m_nick
        FROM book JOIN community
        ON book.b_code = community.c_bcode
        JOIN member ON community.c_id = member.m_id
        WHERE c_code = #{c_code}
    </select>

    <select id="acList" resultType="kr.co.itwill.community.CommacDTO">
        SELECT ac_no, ac_id ,ac_ccode ,ac_cname ,ac_manjok ,ac_review, ac_rdate
        FROM community_ac
        WHERE ac_ccode = #{c_code}
    </select>


    <!-- 현재 커뮤니티의 상태 보기 -->
    <select id="commCheck" resultType="kr.co.itwill.community.CommunityDTO">
        SELECT c_state
        FROM community
        WHERE c_code = #{c_code}
    </select>

    <!--  현재 로그인id의 커뮤니티 가입상태 보기  -->
    <select id="idCheck" resultType="kr.co.itwill.community.CommSignDTO">
        SELECT s_state, s_id
        FROM community_signup
        WHERE s_id = #{s_id} and s_code = #{s_code}
    </select>


    <!--  나만의 서재 조회  -->
    <select id="listMylib" resultType="kr.co.itwill.community.CommunityMylipDTO">
        SELECT lib_id, b_code, b_name, b_bookcover, lib_proc
        FROM mylib
                 JOIN book
                      ON mylib.lib_bcode = book.b_code
        WHERE lib_id = #{loginID} and lib_proc >= 0;
    </select>

    <select id="readBook" resultType="kr.co.itwill.book.BookDTO">
        SELECT b_code, b_name
        FROM book
        WHERE b_code = #{b_code}
    </select>

    <insert id="insert" parameterType="kr.co.itwill.community.CommunityDTO">
        INSERT INTO community (c_code, c_name, c_des, c_bcode, c_local, c_id, c_chat, c_banner ,c_count)
        VALUES (#{c_code}, #{c_name}, #{c_des}, #{c_bcode}, #{c_local}, #{c_id}, #{c_chat}, #{c_banner}, #{c_count})
    </insert>

</mapper>