<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="survey">

	<select id="list" resultType="kr.co.itwill.survey.SurveyDTO">
		SELECT sv_code, sv_comcode, sv_id, sv_title, sv_des, sv_rdate, sv_edate, sv_max, sv_status
		FROM survey
		ORDER BY sv_code
	</select>
	
	<select id="svcode" resultType="String">
		SELECT sv_code
		FROM survey
		WHERE sv_comcode = #{c_code}
	</select>
	
	
	<select id="title" resultType="kr.co.itwill.survey.DsurveyDTO">
		SELECT dsv_subject, dsv_type, dsv_order
		FROM dsurvey
		WHERE dsv_code = #{dsv_code}
	</select>
	
	<select id="count" resultType="int">
		SELECT COUNT(*)
		FROM dsurvey
		WHERE dsv_code = #{dsv_code}
	</select>
	
	<select id="answer" resultType="kr.co.itwill.survey.AnswerDTO">
		SELECT ans_no, ans_code, ans_order, ans_anscode, ans_id, ans_content
		FROM answer
		WHERE ans_code = #{ans_code} AND ans_id = #{ans_id}
	</select>
	
	<select id="tpl" resultType="kr.co.itwill.survey.tempDTO">
		SELECT tem_no, tem_title, tem_code
		FROM temp
	</select>
	
	<select id="tplread" resultType="kr.co.itwill.survey.templetDTO">
		SELECT *
		FROM 
		(
		SELECT tem_no, tem_title, tem_code
		FROM temp
		) AS AA RIGHT OUTER JOIN (
		SELECT tefo_no, tefo_code, tefo_type, tefo_order, tefo_subject, tefo_check
		FROM temp_info
		) AS BB
		ON AA.tem_code = BB.tefo_code ;
	</select>
	
	<select id="choice" resultType="kr.co.itwill.survey.ChoiceDTO">
		SELECT ch_no, ch_code, ch_order, ch_type, ch_anscode, ch_content
		FROM	choice
		WHERE ch_code = #{dsv_code}
		ORDER BY ch_anscode ASC
	</select>
	
	<delete id="ansdelete">
		DELETE FROM answer
		WHERE ans_code = #{ans_code} AND ans_id = #{ans_id}
	</delete>
	
	<insert id="insert" parameterType="kr.co.itwill.survey.AnswerDTO">
	 	INSERT INTO answer(ans_code, ans_order, ans_anscode, ans_id, ans_content)
		VALUES (#{ans_code},  #{ans_order}, #{ans_anscode}, #{ans_id}, #{ans_content}  )
	 </insert>
	
	
	<!-- survey -->
	<insert id="surveyWrite" parameterType="kr.co.itwill.survey.SurveyDTO">
		INSERT INTO survey( sv_code, sv_comcode, sv_id, sv_title, sv_des, sv_edate, sv_max )
		VALUES ( #{sv_code}, #{sv_comcode}, #{sv_id}, #{sv_title}, #{sv_des}, #{sv_edate}, #{sv_max} )
	</insert>
	
	<!-- dsurvey -->
	<insert id="questionWrite" parameterType="kr.co.itwill.survey.DsurveyDTO">
		INSERT INTO dsurvey( dsv_code, dsv_type, dsv_order, dsv_subject )
		VALUES ( #{dsv_code}, #{dsv_type}, #{dsv_order}, #{dsv_subject} )
	</insert>	
	
	<!-- choice -->
	<insert id="items" parameterType="kr.co.itwill.survey.ChoiceDTO">
		INSERT INTO choice( ch_code, ch_order, ch_type, ch_anscode, ch_content)
		VALUES ( #{ch_code}, #{ch_order}, #{ch_type}, #{ch_anscode}, #{ch_content} )
	</insert>	
		
	
	<delete id="delete" >
		DELETE FROM dsurvey
		WHERE dsv_code = #{sv_code};
		
        DELETE FROM choice
        WHERE ch_code = #{sv_code};
        
        DELETE FROM answer
        WHERE ans_code = #{sv_code};
	
		DELETE FROM survey
        WHERE sv_code = #{sv_code};
        

	</delete>
	
	<select id="read" resultType="kr.co.itwill.survey.SurveyDTO">
		SELECT sv_code, sv_comcode, sv_id, sv_title, sv_des, sv_rdate, sv_edate, sv_max, sv_status
		FROM survey
		WHERE sv_code = #{sv_code}
	</select>
	
	<update id="update">
		UPDATE survey
        SET sv_title    = #{sv_title}
            ,sv_des    = #{sv_des}
        WHERE sv_code  = #{sv_code}
	</update>
	
</mapper>
