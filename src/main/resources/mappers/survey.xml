<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="survey">

	<select id="list" resultType="kr.co.itwill.survey.SurveyDTO">
		SELECT sv_code, sv_comcode, sv_id, sv_title, sv_des, sv_rdate, sv_edate, sv_max, sv_status
		FROM survey
		ORDER BY sv_code
	</select>
	
	<select id="title" resultType="kr.co.itwill.survey.DsurveyDTO">
		SELECT dsv_subject, dsv_type, dsv_order
		FROM dsurvey
		WHERE dsv_code = #{dsv_code}
	</select>
	
	<select id="choice" resultType="kr.co.itwill.survey.ChoiceDTO">
		SELECT ch_no, ch_code, ch_dsvno, ch_order, ch_type, ch_anscode, ch_content
		FROM	choice
		WHERE ch_code = #{dsv_code}
	</select>
	
	<insert id="insert" parameterType="kr.co.itwill.survey.AnswerDTO">
	 	INSERT INTO answer(ans_code, ans_dsvno, ans_order, ans_anscode, ans_id, ans_content)
		VALUES (#{ch_code}, #{ch_dsvno}, #{ch_order}, #{ch_anscode}, "cloudd81", #{ch_content}  )
	 </insert>
	
	
	<!-- answer -->
	
	
	<!-- choice -->
	<insert id="surveyWrite" parameterType="kr.co.itwill.survey.SurveyDTO">
		INSERT INTO survey( sv_code, sv_title, sv_des )
		VALUES ( #{s_idx}, #{s_title}, #{s_content})
		<selectKey keyProperty="s_idx" resultType="Integer">
		SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<insert id="questionWrite" parameterType="kr.co.itwill.survey.SurveyDTO">
		INSERT INTO dsurvey( dsv_code, dsv_no, dsv_subject, dsv_type )
		VALUES 
		<foreach item="q" index="index" collection="questions" separator=","> 
		( #{s_idx}, #{index}+1, #{q.q_title}, #{q.q_type} )
		</foreach>
	</insert>
	
	<insert id="items" parameterType="kr.co.itwill.survey.DsurveyDTO">
		INSERT INTO choice(ch_code, ch_dsvno, ch_no, ch_content)
		
		VALUES
		<foreach item="i" index="index" collection="items" separator=",">
		(
			#{s_idx},
			#{q_idx},
			#{index}+1,
			#{i.i_content}
		)
		</foreach>
	</insert>
	
</mapper>
